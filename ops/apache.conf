<VirtualHost *:8080>
    DocumentRoot /usr/local/apache2/htdocs
    ServerName localhost
    
    # Configuration de sécurité
    ServerSignature Off
    
    # En-têtes de sécurité
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"
    Header always set Cross-Origin-Opener-Policy "same-origin"
    Header always set Cross-Origin-Resource-Policy "same-origin"
    Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self' http://backend:3001; frame-ancestors 'none';"
    
    # Health check
    <Location "/healthz">
        Header set Content-Type "text/plain"
        RewriteEngine On
        RewriteRule ^.*$ - [R=200,L]
    </Location>
    
    # robots.txt
    <Location "/robots.txt">
        Header set Content-Type "text/plain"
        RewriteEngine On
        RewriteRule ^.*$ - [R=200,L]
    </Location>
    
    # Configuration pour SPA
    <Directory "/usr/local/apache2/htdocs">
        Options -Indexes
        AllowOverride None
        Require all granted
        
        # Fallback pour SPA
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Désactiver les logs d'accès pour les assets statiques
    SetEnvIf Request_URI "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$" dontlog
    CustomLog /proc/self/fd/1 common env=!dontlog
    ErrorLog /proc/self/fd/2
</VirtualHost>
